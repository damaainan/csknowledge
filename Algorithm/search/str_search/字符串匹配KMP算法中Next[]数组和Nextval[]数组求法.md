# [字符串匹配KMP算法中`Next[]`数组和`Nextval[]`数组求法](http://www.cnblogs.com/Amedeo/p/6253453.html)

数据结构课本上给了这么一段算法求nextval9[]数组

```
int get_nextval(SString T,int &nextval[ ])
{
       //求模式串T的next函数修正值并存入数组nextval。
       i=1; nextval[1]=0; j=0;
       while(i<T[0]
       {
           if(j==0||T[i]==T[j])
           {
               ++i;
               ++j;
               if (T[i]!=T[j]) 
                   nextval[i]=j;
               else 
                   nextval[i]=nextval[j];
           }
           else 
               j=nextval[j];
       }
}
//get_nextval
```

根据这段程序来求nextval的值是可以方便计算出来，但如果是应付考研试题或者期末考试就有点麻烦了。而如果记住我推荐的方法，那么任何时候都可以很方便地求解nextval了。  
首先看看**next数组值**的求解方法。  
例如： 

模式串 | a | b | a | a | b | c | a | c  
-|-|-|-|-|-|-|-|-
next值 | 0 | 1 | 1 | 2 | 2 | 3 | 1 | 2  
nextval值 |

next数组的求解方法是：第一位的next值为0，第二位的next值为1，后面求解每一位的next值时，根据前一位进行比较。首先将前一位与其next值对应的内容进行比较，如果相等，则该位的next值就是前一位的next值加上1；如果不等，向前继续寻找next值对应的内容来与前一位进行比较，直到找到某个位上内容的next值对应的内容与前一位相等为止，则这个位对应的值加上1即为需求的next值；如果找到第一位都没有找到与前一位相等的内容，那么需求的位上的next值即为1。  
看起来很令人费解，利用上面的例子具体运算一遍。  
1.前两位必定为0和1。  
2.计算第三位的时候，看第二位b的next值，为1，则把b和1对应的a进行比较，不同，则第三位a的next的值为1，因为一直比到最前一位，都没有发生比较相同的现象。  
3.计算第四位的时候，看第三位a的next值，为1，则把a和1对应的a进行比较，相同，则第四位a的next的值为第三位a的next值加上1。为2。因为是在第三位实现了其next值对应的值与第三位的值相同。  
4.计算第五位的时候，看第四位a的next值，为2，则把a和2对应的b进行比较，不同，则再将b对应的next值1对应的a与第四位的a进行比较，相同，则第五位的next值为第二位b的next值加上1，为2。因为是在第二位实现了其next值对应的值与第四位的值相同。  
5.计算第六位的时候，看第五位b的next值，为2，则把b和2对应的b进行比较，相同，则第六位c的next值为第五位b的next值加上1，为3，因为是在第五位实现了其next值对应的值与第五位相同。  
6.计算第七位的时候，看第六位c的next值，为3，则把c和3对应的a进行比较，不同，则再把第3位a的next值1对应的a与第六位c比较，仍然不同，则第七位的next值为1。  
7.计算第八位的时候，看第七位a的next值，为1，则把a和1对应的a进行比较，相同，则第八位c的next值为第七位a的next值加上1，为2，因为是在第七位和实现了其next值对应的值与第七位相同。  
在计算nextval之前要先弄明白，nextval是为了弥补next函数在某些情况下的缺陷而产生的，例如主串为“aaabaaaab”、模式串为“aaaab”那么，比较的时候就会发生一些浪费的情况：比较到主串以及模式串的第四位时，发现其值并不相等，据我们观察，我们可以直接从主串的第五位开始与模式串进行比较，而事实上，却进行了几次多余的比较。使用nextval可以去除那些不必要的比较次数。  
求**nextval数组值**有两种方法，一种是不依赖next数组值直接用观察法求得，一种方法是根据next数组值进行推理，两种方法均可使用，视更喜欢哪种方法而定。  
我们使用例子“aaaab”来考查**第一种方法**。  
1.试想，在进行模式匹配的过程中，将模式串“aaaab”与主串进行匹配的时候，如果第一位就没有吻合，即第一位就不是a，那么不用比较了，赶快挪到主串的下一位继续与模式串的第一位进行比较吧，这时，模式串并没有发生偏移，那么，模式串第一位a的nextval值为0。  
2.如果在匹配过程中，到第二位才发生不匹配现象，那么主串的第一位必定是a，而第二位必定不为a，既然知道第二位一定不为a，那么主串的第一、二两位就没有再进行比较的必要，直接跳到第三位来与模式串的第一位进行比较吧，同样，模式串也没有发生偏移，第二位的nextval值仍然为0。  
3.第三位、第四位类似2的过程，均为0。  
4.如果在匹配过程中，直到第五位才发生不匹配现象，那么主串的第一位到第四位必定为a，并且第五位必定不为b，可是第五位仍然有可能等于a。如果万一第五位为a，那么既然前面四位均为a，所以，只要第六位为b，第一个字符串就匹配成功了。所以，现在的情况下，就是看第五位究竟是不是a了。所以发生了下面的比较： 

1 | 2 | 3 | 4 | 5 | 6  
-|-|-|-|-|-
a | a | a | a | * | *  
a | a | a | a | b | -
- | a | a | a | a | b

前面的三个a都不需要进行比较，只要确定主串中不等于b的那个位是否为a，即可以进行如下的比较：如果为a，则继续比较主串后面一位是否为b；如果不为a，则此次比较结束，继续将模式串的第一位去与主串的下一位进行比较。由此看来，在模式串的第五位上，进行的比较偏移了4位（不进行偏移，直接比较下一位为0），故第五位b的nextval值为4。  
我们可以利用第一个例子“abaabcac”对这种方法进行验证。  
a的nextval值为0，因为如果主串的第一位不是a，那么没有再比较下去的必要，直接比较主串的第二位是否为a。如果比较到主串的第二位才发生错误，则主串第一位肯定为a，第二位肯定不为b，此时不能直接跳到第三位进行比较，因为第二位还可能是a，所以对主串的第二位再进行一次比较，偏移了1位，故模式串第二位的nextval值为1。以此类推，nextval值分别为：01021302。其中第六位的nextval之所以为3，是因为，如果主串比较到第六位才发生不匹配现象，那么主串的前五位必定为“abaab”且第六位必定不是“c”，但第六位如果为“a”的话，那么我们就可以从模式串的第四位继续比较下去。所以，这次比较为：

1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12  
-|-|-|-|-|-|-|-|-|-|-|-
a | b | a | a | b | * | * | * | * | * | * | *  
- | - | - | a | b | a | a | b | c | a | c | -

  
而不是： 

1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12  
-|-|-|-|-|-|-|-|-|-|-|-
a | b | a | a | b | * | * | * | * | * | * | *   
- | - | - | - | - | a | b | a | a | b | c | a

  
因为前两位a和b已经确定了，所以不需要再进行比较了。所以模式串第六位的nextval值为这次比较的偏移量3。  
再来看求nextval数组值的**第二种方法**。  
 
模式串 |  a  | b | a | a | b | c | a | c  
-|-|-|-|-|-|-|-|-
next值 |  0  | 1 | 1 | 2 | 2 | 3 | 1 | 2 
nextval值 |  0  | 1 | 0 | 2 | 1 | 3 | 0 | 2

  
1.第一位的nextval值必定为0，第二位如果与第一位相同则为0，如果不同则为1。  
2.第三位的next值为1，那么将第三位和第一位进行比较，均为a，相同，则，第三位的nextval值为0。  
3.第四位的next值为2，那么将第四位和第二位进行比较，不同，则第四位的nextval值为其next值，为2。  
4.第五位的next值为2，那么将第五位和第二位进行比较，相同，第二位的next值为1，则继续将第二位与第一位进行比较，不同，则第五位的nextval值为第二位的next值，为1。  
5.第六位的next值为3，那么将第六位和第三位进行比较，不同，则第六位的nextval值为其next值，为3。  
6.第七位的next值为1，那么将第七位和第一位进行比较，相同，则第七位的nextval值为0。  
7.第八位的next值为2，那么将第八位和第二位进行比较，不同，则第八位的nextval值为其next值，为2。  
在“aaaab”内进行验证。 

模式串 |  a  | a | a | a | b  
-|-|-|-|-|-
next值 |  0  | 1 | 2 | 3 | 4  
nextval值 |  0  | 0 | 0 | 0 | 4

[0]: http://www.cnblogs.com/Amedeo/p/6253453.html